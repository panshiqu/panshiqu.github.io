---
layout: default
---

# 游戏、网关等服务借助Docker容器化并使用Kubernetes部署、更新等
_2024-08-24 10:00:00_

* * *

请先看完
* [实现负责消息转发、推送的网关服务](093.html)
* [负责网络、定时、坐下、站起、重连等，支持多类游戏的无锁房间](092.html)

## Docker容器化

#### Build and Push
```bash
docker build -t panshiqu/game_server:latest -t panshiqu/game_server:1 -t panshiqu/game_server:1.0 --build-arg SERVER=game_server .
docker build -t panshiqu/gate_server:latest -t panshiqu/gate_server:1 -t panshiqu/gate_server:1.0 --build-arg SERVER=gate_server .

docker push panshiqu/game_server:latest
docker push panshiqu/game_server:1
docker push panshiqu/game_server:1.0
docker push panshiqu/gate_server:latest
docker push panshiqu/gate_server:1
docker push panshiqu/gate_server:1.0
```

#### 验证
```bash
# 创建网络使用别名发现服务
docker network create server

docker run --network server --network-alias dice --name game_server -p 60001:60001 --rm panshiqu/game_server:1.0
docker run --network server --name gate_server -p 60006:60006 -e JWT_KEY=ZGVmYXVsdF9rZXk= --rm panshiqu/gate_server:1.0

cd ~/go/src/github.com/panshiqu/server/game_server/game/dice/client
go run main.go
```

## Kubernetes容器编排

#### 部署
```bash
kubectl apply -f https://raw.githubusercontent.com/panshiqu/server/main/k8s/dice.yaml

kubectl create secret generic jwt --from-literal=key=ZGVmYXVsdF9rZXk=

kubectl apply -f https://raw.githubusercontent.com/panshiqu/server/main/k8s/gate.yaml

minikube service gate --url # Mac DockerDesktop minikube print the port
cd ~/go/src/github.com/panshiqu/server/game_server/game/dice/client
go run main.go -port 60006
```

#### EFK (Elasticsearch + Fluentd + Kibana)
方案取自以下官方文档
* [日志架构](https://kubernetes.io/zh-cn/docs/concepts/cluster-administration/logging/)
* [Fluentd](https://docs.fluentd.org/container-deployment/kubernetes)
* [快速开始系列](https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-quickstart.html)：其中[Elasticsearch](https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-deploy-elasticsearch.html)和[Kibana](https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-deploy-kibana.html)

_未完..._
